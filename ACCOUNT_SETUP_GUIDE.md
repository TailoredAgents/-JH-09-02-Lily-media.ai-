# Account Setup & Login Guide for AI Social Media Agent

## Overview
The platform uses a **registration key system** for security. New users cannot sign up directly - they need a registration key generated by an admin.

## Two Types of Accounts

### 1. Admin Account (Backend Management)
- **Purpose**: System administration, user management, registration key generation
- **Login URL**: `/admin/login` on your backend
- **Default Credentials** (from `create_admin_simple.py`):
  - Username: `superadmin`
  - Email: `jeffrey@tailoredagents.com`
  - Password: `Admin053103`

### 2. Regular User Account (Platform Users)
- **Purpose**: Using the social media automation features
- **Login URL**: `/login` on your frontend
- **Registration**: Requires a registration key from admin

## Initial Setup Process

### Step 1: Create Admin Account (One-time setup)

#### Option A: Using Render Shell (Recommended)
1. Go to your Render dashboard
2. Navigate to your backend web service
3. Click on "Shell" tab
4. Run:
```bash
python create_admin_simple.py
```

#### Option B: Local Setup (if you have database access)
```bash
# Set your production database URL
export DATABASE_URL="your-database-url-here"

# Run the admin creation script
python create_admin_simple.py
```

### Step 2: Access Admin Panel
1. Navigate to: `https://your-backend-url.onrender.com/admin/login`
2. Login with the superadmin credentials

### Step 3: Generate Registration Keys
Once logged in as admin, you can create registration keys for users:

1. Use the admin API endpoint: `POST /api/admin/registration-keys`
2. Request body:
```json
{
  "description": "Registration key for new user",
  "max_uses": 1,
  "expires_at": "2025-12-31T23:59:59Z",
  "email_domain_restriction": null,
  "is_active": true
}
```

### Step 4: Create Regular User Account
With a registration key, users can register:

1. Navigate to: `https://your-frontend-url.onrender.com/register`
2. Fill in the registration form:
   - Email
   - Username
   - Password
   - Full Name
   - **Registration Key** (from Step 3)

### Step 5: Login as Regular User
1. Navigate to: `https://your-frontend-url.onrender.com/login`
2. Enter email and password
3. Complete 2FA if enabled

## API Endpoints

### Authentication Endpoints
- **Register**: `POST /api/auth/register`
  ```json
  {
    "email": "user@example.com",
    "username": "username",
    "password": "password",
    "full_name": "Full Name",
    "registration_key": "key-from-admin"
  }
  ```

- **Login**: `POST /api/auth/login`
  ```json
  {
    "email": "user@example.com",
    "password": "password",
    "totp_code": "123456"  // Optional, if 2FA enabled
  }
  ```

### Admin Endpoints
- **Admin Login**: `POST /api/admin/auth/login`
  ```json
  {
    "username": "superadmin",
    "password": "Admin053103"
  }
  ```

- **Create Registration Key**: `POST /api/admin/registration-keys` (requires admin auth)
- **List Registration Keys**: `GET /api/admin/registration-keys` (requires admin auth)
- **List Users**: `GET /api/admin/users` (requires admin auth)

## Security Features

### Registration Key System
- **Purpose**: Prevents unauthorized signups
- **Features**:
  - Configurable max uses (single-use or multi-use)
  - Expiration dates
  - Email domain restrictions (e.g., only @company.com)
  - Tracking of who used which key

### Two-Factor Authentication (2FA)
- Optional but recommended
- TOTP-based (Time-based One-Time Password)
- Backup codes available
- Can be enabled after account creation

### Password Requirements
- Minimum 8 characters
- Should contain uppercase, lowercase, numbers, and special characters
- Hashed using bcrypt

## Troubleshooting

### Can't Create Admin Account
1. Check database connection: Ensure `DATABASE_URL` is set correctly
2. Check if admin already exists: Query `admin_users` table
3. Check logs for specific errors

### Registration Key Not Working
1. Check if key is expired
2. Check if key has reached max uses
3. Check email domain restrictions
4. Verify key is active

### Can't Login
1. Verify credentials are correct
2. Check if account is active
3. Check if 2FA is required
4. Check CORS settings if frontend/backend on different domains

### Database Access
To check users directly in the database:
```sql
-- Check admin users
SELECT * FROM admin_users;

-- Check regular users
SELECT id, email, username, is_active, created_at FROM users;

-- Check registration keys
SELECT * FROM registration_keys;
```

## Environment Variables Required
```bash
# Backend (.env)
DATABASE_URL=postgresql://...
SECRET_KEY=your-secret-key
OPENAI_API_KEY=your-openai-key  # For AI features

# Frontend (.env)
VITE_API_BASE_URL=https://your-backend-url.onrender.com
```

## Quick Start Commands

### 1. Create Admin (run once in Render shell)
```bash
python create_admin_simple.py
```

### 2. Generate Registration Key (using curl)
```bash
# First, login as admin to get token
TOKEN=$(curl -X POST https://your-backend.onrender.com/api/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"superadmin","password":"Admin053103"}' \
  | jq -r '.access_token')

# Create registration key
curl -X POST https://your-backend.onrender.com/api/admin/registration-keys \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "New user key",
    "max_uses": 1,
    "expires_at": "2025-12-31T23:59:59Z",
    "is_active": true
  }'
```

### 3. Register New User
```bash
curl -X POST https://your-backend.onrender.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser@example.com",
    "username": "newuser",
    "password": "SecurePassword123!",
    "full_name": "New User",
    "registration_key": "your-registration-key-here"
  }'
```

## Notes
- The admin account is separate from regular user accounts
- Admin accounts can only manage the system, not use social media features
- Regular users need registration keys but have full access to platform features
- Always use HTTPS in production
- Keep registration keys secure and track their usage